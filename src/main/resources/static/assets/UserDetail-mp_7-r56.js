import{u as q,a as W,r as u,F as r,b as w,j as e,S as C,A as F,c as o,B as c,T as _,R as G,C as U,I as d,d as S,e as D,f as h,g as b,D as a,h as J,i as j,M as K,k as Q,l as X,s as L}from"./index-afCWbyQR.js";import{R as Y,a as Z,b as k,f as E,g as ee,c as se,d as T}from"./storageService-BXbe-IV2.js";import{R as ne,D as le}from"./ArrowLeftOutlined-BRSBGch-.js";const{Title:ie,Text:i}=_,ce=()=>{const{id:m}=q(),$=W(),[l,f]=u.useState(null),[z,I]=u.useState(!1),[p,y]=u.useState(!1),[x]=r.useForm(),{data:s,loading:A,error:v}=w(async n=>{const t=await Q(n);if(t.businessLicense)try{const g=await T(t.businessLicense);f(g)}catch(g){console.error("File download URL error:",g)}return x.setFieldsValue({name:t.name,phone:t.phone,company:t.company,shop:t.shop,role:t.role,businessLicense:t.businessLicense}),t},{manual:!m,defaultParams:[m],onError:n=>{console.error("User detail error:",n)}}),{loading:B}=w(T,{manual:!0,onSuccess:n=>{f(n)},onError:n=>{console.error("File download URL error:",n)}}),M=()=>{$("/users")},N=()=>{y(!0)},O=()=>{y(!1),x.setFieldsValue({name:s==null?void 0:s.name,phone:s==null?void 0:s.phone,company:s==null?void 0:s.company,shop:s==null?void 0:s.shop,role:s==null?void 0:s.role,businessLicense:s==null?void 0:s.businessLicense})},P=async()=>{try{const n=await x.validateFields(),t={name:n.name,phone:n.phone,company:n.company,shop:n.shop,role:n.role,businessLicense:n.businessLicense};await X(m,t),L.success("用户更新成功"),y(!1)}catch(n){console.error("Save error:",n),L.error("保存失败，请重试")}},V=()=>{if(l!=null&&l.downloadUrl){const n=document.createElement("a");n.href=l.downloadUrl,n.download=l.fileName||"business_license",document.body.appendChild(n),n.click(),document.body.removeChild(n)}},R=()=>{l!=null&&l.downloadUrl&&I(!0)},H=()=>{I(!1)};return A?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsx(C,{size:"large"})}):v?e.jsx(F,{message:v,type:"error",showIcon:!0,style:{margin:"24px"}}):s?e.jsxs("div",{style:{padding:"0 0 24px 0"},children:[e.jsxs("div",{style:{marginBottom:24,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(o,{children:[e.jsx(c,{type:"text",icon:e.jsx(ne,{}),onClick:M,children:"返回用户列表"}),e.jsx(le,{type:"vertical"}),e.jsx(ie,{level:2,style:{margin:0},children:"用户详情"})]}),p?e.jsxs(o,{children:[e.jsx(c,{type:"default",icon:e.jsx(Y,{}),onClick:O,children:"取消"}),e.jsx(c,{type:"primary",icon:e.jsx(Z,{}),onClick:P,children:"保存"})]}):e.jsx(c,{type:"primary",icon:e.jsx(G,{}),onClick:N,children:"编辑用户"})]}),e.jsx(U,{title:"基本信息",style:{marginBottom:24},children:p?e.jsxs(r,{form:x,layout:"vertical",children:[e.jsx(r.Item,{label:"用户ID",children:e.jsx(i,{code:!0,children:s==null?void 0:s.id})}),e.jsx(r.Item,{name:"name",label:e.jsxs("span",{children:[e.jsx(S,{style:{marginRight:4}}),"姓名"]}),rules:[{required:!0,message:"请输入姓名"}],children:e.jsx(d,{placeholder:"请输入姓名"})}),e.jsx(r.Item,{name:"phone",label:e.jsxs("span",{children:[e.jsx(D,{style:{marginRight:4}}),"手机号"]}),rules:[{required:!0,message:"请输入手机号"}],children:e.jsx(d,{placeholder:"请输入手机号"})}),e.jsx(r.Item,{name:"company",label:"公司",children:e.jsx(d,{placeholder:"请输入公司名称"})}),e.jsx(r.Item,{name:"shop",label:"门店",children:e.jsx(d,{placeholder:"请输入门店名称"})}),e.jsx(r.Item,{name:"role",label:"职位",children:e.jsxs(h,{placeholder:"请选择职位",children:[e.jsx(h.Option,{value:"admin",children:"管理员"}),e.jsx(h.Option,{value:"driver",children:"司机"}),e.jsx(h.Option,{value:"user",children:"普通用户"}),e.jsx(h.Option,{value:"manager",children:"经理"})]})}),e.jsx(r.Item,{name:"businessLicense",label:e.jsxs("span",{children:[e.jsx(k,{style:{marginRight:4}}),"营业执照"]}),children:e.jsx(d,{placeholder:"请输入营业执照文件路径"})}),e.jsx(r.Item,{label:"用户状态",children:e.jsx(b,{color:"success",children:"正常"})})]}):e.jsxs(a,{column:2,bordered:!0,children:[e.jsx(a.Item,{label:"用户ID",span:2,children:e.jsx(i,{code:!0,children:s==null?void 0:s.id})}),e.jsx(a.Item,{label:e.jsxs("span",{children:[e.jsx(S,{style:{marginRight:4}}),"姓名"]}),children:e.jsx(i,{strong:!0,children:(s==null?void 0:s.name)||"未设置"})}),e.jsx(a.Item,{label:e.jsxs("span",{children:[e.jsx(D,{style:{marginRight:4}}),"手机号"]}),children:e.jsx(i,{strong:!0,children:(s==null?void 0:s.phone)||"未设置"})}),e.jsx(a.Item,{label:"公司",children:e.jsx(i,{strong:!0,children:(s==null?void 0:s.company)||"未设置"})}),e.jsx(a.Item,{label:"门店",children:e.jsx(i,{strong:!0,children:(s==null?void 0:s.shop)||"未设置"})}),e.jsx(a.Item,{label:"职位",children:e.jsx(b,{color:"purple",children:(s==null?void 0:s.role)||"未设置"})}),e.jsx(a.Item,{label:e.jsxs("span",{children:[e.jsx(k,{style:{marginRight:4}}),"营业执照"]}),children:s!=null&&s.businessLicense?e.jsx("div",{children:e.jsx(o,{direction:"vertical",size:"small",children:B?e.jsx(C,{size:"small"}):l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(i,{strong:!0,children:l.fileName}),e.jsx("br",{}),e.jsxs(i,{type:"secondary",children:[E(l.fileSize)," • ",l.fileType.toUpperCase()]})]}),ee(l.fileName)==="image"&&e.jsx("div",{children:e.jsx("img",{src:l.downloadUrl,alt:"营业执照",style:{maxWidth:"200px",maxHeight:"150px",border:"1px solid #d9d9d9",borderRadius:"4px",cursor:"pointer"},onClick:R})}),e.jsxs(o,{children:[e.jsx(c,{type:"primary",size:"small",icon:e.jsx(J,{}),onClick:R,children:"预览"}),e.jsx(c,{type:"default",size:"small",icon:e.jsx(se,{}),onClick:V,children:"下载"})]})]}):e.jsx(i,{type:"warning",children:"无法获取文件信息"})})}):e.jsx(i,{type:"secondary",children:"未上传"})}),e.jsx(a.Item,{label:"用户状态",children:e.jsx(b,{color:"success",children:"正常"})})]})}),e.jsx(U,{title:"时间信息",children:p?e.jsxs(r,{children:[e.jsx(r.Item,{label:e.jsxs("span",{children:[e.jsx(j,{style:{marginRight:4}}),"创建时间"]}),children:e.jsx(i,{code:!0,children:s==null?void 0:s.createdAt})}),e.jsx(r.Item,{label:e.jsxs("span",{children:[e.jsx(j,{style:{marginRight:4}}),"更新时间"]}),children:e.jsx(i,{code:!0,children:s==null?void 0:s.updatedAt})})]}):e.jsxs(a,{column:2,bordered:!0,children:[e.jsx(a.Item,{label:e.jsxs("span",{children:[e.jsx(j,{style:{marginRight:4}}),"创建时间"]}),children:e.jsx(i,{children:s==null?void 0:s.createdAt})}),e.jsx(a.Item,{label:e.jsxs("span",{children:[e.jsx(j,{style:{marginRight:4}}),"更新时间"]}),children:e.jsx(i,{children:s==null?void 0:s.updatedAt})})]})}),e.jsx(K,{title:"营业执照预览",open:z,onCancel:H,footer:null,width:800,centered:!0,destroyOnClose:!0,children:(l==null?void 0:l.downloadUrl)&&e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("img",{src:l.downloadUrl,alt:"营业执照预览",style:{maxWidth:"100%",maxHeight:"600px",objectFit:"contain"}}),e.jsx("div",{style:{marginTop:16},children:e.jsxs(o,{children:[e.jsx(i,{strong:!0,children:l.fileName}),e.jsxs(i,{type:"secondary",children:[E(l.fileSize)," • ",l.fileType.toUpperCase()]})]})})]})})]}):e.jsx(F,{message:"用户不存在",type:"warning",showIcon:!0,style:{margin:"24px"}})};export{ce as default};
