import{F as t,r as j,a as A,c,j as s,C as J,T as K,I as y,B as o,e as f,m as N,n as Q,M as _,ao as S,i as G,k as H,R as U,P as W,s as X,am as r}from"./index-BtDz0sTi.js";import{s as d}from"./shopService-B8yayHhO.js";import{R as Y}from"./ReloadOutlined-BHq4VUCG.js";const{Title:Z}=K,{Search:ee}=y,ae=()=>{const[h]=t.useForm(),[I,i]=j.useState(!1),[u,g]=j.useState(null),[l]=t.useForm(),[p,m]=j.useState({page:1,size:10}),k=A(),{data:w={records:[],total:0,pages:0,current:1,size:10},loading:x,run:a}=c(d.getShops,{defaultParams:[p],onError:e=>{console.error("Shops fetch error:",e),r.error("获取店铺列表失败")}}),{records:C=[],total:z,current:R,size:T}=w,F={current:R,pageSize:T,total:z,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,n)=>`第 ${n[0]}-${n[1]} 条/共 ${e} 条`},{run:v}=c(d.deleteShop,{manual:!0,onSuccess:()=>{r.success("删除成功"),a({})},onError:e=>{r.error("删除失败")}}),{run:E}=c(d.createShop,{manual:!0,onSuccess:()=>{r.success("创建成功"),i(!1),a()},onError:e=>{r.error("创建失败")}}),{run:$}=c(d.updateShop,{manual:!0,onSuccess:()=>{r.success("更新成功"),i(!1),a()},onError:e=>{r.error("更新失败")}}),b=e=>{m({page:e.current,size:e.pageSize})},P=()=>{const e=h.getFieldsValue();m({...p,page:1}),a({...e,page:1,size:p.size})},D=()=>{h.resetFields(),m({page:1,size:10}),a({page:1,size:10})},L=()=>{g(null),l.resetFields(),i(!0)},M=e=>{g(e),l.setFieldsValue({name:e.name}),i(!0)},V=e=>{v(e)},B=async()=>{try{const e=await l.validateFields();u?$(u.id.toString(),e):E(e)}catch{r.error("操作失败")}},O=e=>{k(`/shops/${e.shopId}`)},q=[{title:"ID",dataIndex:"id",key:"id",width:80},{title:"店铺ID",dataIndex:"shopId",key:"shopId",width:120,ellipsis:{showTitle:!1},render:e=>s.jsx(S,{placement:"topLeft",title:e,children:e})},{title:"店铺名称",dataIndex:"name",key:"name",width:120,ellipsis:{showTitle:!1},render:e=>s.jsx(S,{placement:"topLeft",title:e,children:e})},{title:"状态",dataIndex:"deleted",key:"deleted",width:100,render:e=>s.jsx(G,{color:e===0?"green":"red",children:e===0?"正常":"已删除"})},{title:"操作",key:"action",width:200,render:(e,n)=>s.jsxs(f,{size:"middle",children:[s.jsx(o,{type:"link",icon:s.jsx(H,{}),onClick:()=>O(n),children:"详情"}),s.jsx(o,{type:"link",icon:s.jsx(U,{}),onClick:()=>M(n),children:"编辑"}),s.jsx(W,{title:"确定要删除这个店铺吗？",onConfirm:()=>V(n.id.toString()),okText:"确定",cancelText:"取消",children:s.jsx(o,{type:"link",danger:!0,icon:s.jsx(X,{}),children:"删除"})})]})}];return s.jsxs(J,{children:[s.jsx("div",{style:{marginBottom:"16px"},children:s.jsx(Z,{level:4,children:"店铺管理"})}),s.jsxs(t,{form:h,layout:"inline",style:{marginBottom:"16px"},children:[s.jsx(t.Item,{name:"name",children:s.jsx(ee,{placeholder:"请输入店铺名称",style:{width:200},onSearch:P,allowClear:!0})}),s.jsx(t.Item,{children:s.jsx(o,{onClick:D,children:"重置"})}),s.jsx(t.Item,{style:{marginLeft:"auto"},children:s.jsxs(f,{children:[s.jsx(o,{type:"primary",icon:s.jsx(N,{}),onClick:L,children:"新建店铺"}),s.jsx(o,{icon:s.jsx(Y,{}),onClick:()=>a(),loading:x,children:"刷新"})]})})]}),s.jsx(Q,{columns:q,dataSource:C,rowKey:"id",loading:x,pagination:F,onChange:b,bordered:!0}),s.jsx(_,{title:u?"编辑店铺":"新建店铺",open:I,onOk:B,onCancel:()=>i(!1),confirmLoading:x,children:s.jsx(t,{form:l,layout:"vertical",children:s.jsx(t.Item,{label:"店铺名称",name:"name",rules:[{required:!0,message:"请输入店铺名称"}],children:s.jsx(y,{placeholder:"请输入店铺名称"})})})})]})};export{ae as default};
