import{a as A,u as L,r as j,F as a,c as l,j as e,C as f,e as $,B as c,T as z,D as d,i as y,R as K,m as _,n as G,M as S,I as g,h as R,P as H,s as J,am as s}from"./index-CTY_xFTU.js";import{s as n}from"./shopService-CGNtv7O2.js";import{R as Q}from"./ArrowLeftOutlined-C-ZLS4lo.js";const{Title:W}=z,{Option:X}=R,re=()=>{const v=A(),{id:o}=L(),[k,i]=j.useState(!1),[b,h]=j.useState(!1),[u]=a.useForm(),[m]=a.useForm(),{data:t=null,loading:p,run:I}=l(n.getShop,{manual:!0,onError:r=>{console.error("Shop fetch error:",r),s.error("获取店铺详情失败")}}),{data:E={records:[],total:0,pages:0,current:1,size:10},run:D}=l(n.getRoles,{defaultParams:[{size:100}],onError:r=>{console.error("Roles fetch error:",r),s.error("获取角色列表失败")}}),{data:F=[],run:x}=l(n.getUserShopRolesByShopId,{manual:!0,onError:r=>{console.error("User shop roles fetch error:",r),s.error("获取用户店铺角色列表失败")}}),{records:U=[]}=E,{run:w}=l(n.createUserShopRole,{manual:!0,onSuccess:()=>{s.success("添加成功"),i(!1),x()},onError:r=>{s.error("添加失败")}}),{run:C}=l(n.updateShop,{manual:!0,onSuccess:()=>{s.success("更新成功"),h(!1),I()},onError:r=>{s.error("更新失败")}}),{run:M}=l(n.deleteUserShopRoleByUserAndShop,{manual:!0,onSuccess:()=>{s.success("删除成功"),x()},onError:r=>{s.error("删除失败")}}),B=()=>{u.resetFields(),i(!0)},T=()=>{t&&(m.setFieldsValue({name:t.name}),h(!0))},N=async()=>{try{const r=await u.validateFields();w({...r,shopId:o})}catch{s.error("操作失败")}},O=async()=>{try{const r=await m.validateFields();C(o,r)}catch{s.error("操作失败")}},V=async r=>{M(o,r.shopId)};j.useEffect(()=>{o&&(I(o),x(o)),D()},[o]);const P=[{title:"用户ID",dataIndex:"userId",key:"userId",width:120,ellipsis:!0},{title:"用户名称",dataIndex:"userName",key:"userName",width:120},{title:"角色",dataIndex:"roleName",key:"roleName",width:120},{title:"状态",dataIndex:"deleted",key:"deleted",width:100,render:r=>e.jsx(y,{color:r===0?"green":"red",children:r===0?"正常":"已删除"})},{title:"操作",key:"action",width:100,render:(r,q)=>e.jsx(H,{title:"确定要删除这个用户角色关联吗？",onConfirm:()=>V(q),okText:"确定",cancelText:"取消",children:e.jsx(c,{type:"link",danger:!0,icon:e.jsx(J,{}),children:"删除"})})}];return e.jsxs("div",{children:[e.jsxs(f,{children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsxs($,{children:[e.jsx(c,{icon:e.jsx(Q,{}),onClick:()=>v("/shops"),children:"返回列表"}),e.jsx(W,{level:4,style:{margin:0},children:"店铺详情"})]})}),t&&e.jsxs("div",{children:[e.jsx(f,{title:"基本信息",style:{marginBottom:"24px"},extra:e.jsx(c,{type:"primary",icon:e.jsx(K,{}),onClick:T,children:"编辑店铺"}),children:e.jsxs(d,{column:2,children:[e.jsx(d.Item,{label:"店铺ID",children:t.shopId}),e.jsx(d.Item,{label:"店铺名称",children:t.name}),e.jsx(d.Item,{label:"状态",children:e.jsx(y,{color:t.deleted===0?"green":"red",children:t.deleted===0?"正常":"已删除"})})]})}),e.jsxs(f,{title:"用户角色管理",children:[e.jsx("div",{style:{marginBottom:"16px"},children:e.jsx(c,{type:"primary",icon:e.jsx(_,{}),onClick:B,children:"添加用户角色"})}),e.jsx(G,{columns:P,dataSource:F,rowKey:"id",loading:p,pagination:!1,bordered:!0})]})]})]}),e.jsx(S,{title:"添加用户角色",open:k,onOk:N,onCancel:()=>i(!1),confirmLoading:p,children:e.jsxs(a,{form:u,layout:"vertical",children:[e.jsx(a.Item,{label:"用户ID",name:"userId",rules:[{required:!0,message:"请输入用户ID"}],children:e.jsx(g,{placeholder:"请输入用户ID"})}),e.jsx(a.Item,{label:"角色",name:"roleId",rules:[{required:!0,message:"请选择角色"}],children:e.jsx(R,{placeholder:"请选择角色",children:U.map(r=>e.jsx(X,{value:r.roleId,children:r.name},r.roleId))})})]})}),e.jsx(S,{title:"编辑店铺",open:b,onOk:O,onCancel:()=>h(!1),confirmLoading:p,children:e.jsx(a,{form:m,layout:"vertical",children:e.jsx(a.Item,{label:"店铺名称",name:"name",rules:[{required:!0,message:"请输入店铺名称"}],children:e.jsx(g,{placeholder:"请输入店铺名称"})})})})]})};export{re as default};
