import{a as N,r as h,F as m,b as r,j as e,C as A,T as J,am as a,e as x,B as i,m as O,P as I,s as f,n as Q,M as W,I as G,ah as y,an as H,af as U,k as X,R as Y}from"./index-CTY_xFTU.js";import{g as Z,a as _,u as ee,b as te,d as se}from"./itemService-Dih2Imhu.js";const{Title:ne,Text:b}=J,re=()=>{const w=N(),[s,p]=h.useState([]),[S,l]=h.useState(!1),[o,g]=h.useState(null),[d]=m.useForm(),{data:k=[],loading:R,error:j,run:c}=r(Z,{onError:t=>{console.error("Items fetch error:",t)}}),{run:T}=r(se,{manual:!0,onSuccess:()=>{a.success("删除成功"),c()}}),{run:$}=r(te,{manual:!0,onSuccess:()=>{a.success(`批量删除成功，共删除 ${s.length} 个物品`),p([]),c()}}),C=t=>{T(t)},v=()=>{if(s.length===0){a.warning("请选择要删除的物品");return}$(s)},F=()=>{g(null),d.resetFields(),l(!0)},B=t=>{w(`/items/${t.id}`)},D=t=>{g(t),d.setFieldsValue({name:t.name,price:t.price}),l(!0)},{run:L,loading:z}=r(_,{manual:!0,onSuccess:()=>{a.success("添加成功"),l(!1),c()}}),{run:E,loading:V}=r(ee,{manual:!0,onSuccess:()=>{a.success("更新成功"),l(!1),c()}}),M=z||V,K=t=>{o?E(o.id,t):L(t)},P=[{title:"ID",dataIndex:"id",key:"id",width:80},{title:"名称",dataIndex:"name",key:"name",render:t=>e.jsxs(x,{children:[e.jsx(y,{}),e.jsx(b,{strong:!0,children:t})]})},{title:"价格",dataIndex:"price",key:"price",width:120,render:t=>e.jsxs(b,{style:{color:"#52c41a",fontWeight:"bold"},children:["¥",t==null?void 0:t.toFixed(2)]})},{title:"操作",key:"action",width:200,render:(t,n)=>e.jsxs(x,{size:"middle",children:[e.jsx(i,{type:"default",size:"small",icon:e.jsx(X,{}),onClick:()=>B(n),children:"查看"}),e.jsx(i,{type:"primary",size:"small",icon:e.jsx(Y,{}),onClick:()=>D(n),children:"编辑"}),e.jsx(I,{title:"确定要删除这个物品吗？",onConfirm:()=>C(n.id),okText:"确定",cancelText:"取消",children:e.jsx(i,{type:"primary",danger:!0,size:"small",icon:e.jsx(f,{}),children:"删除"})})]})}],q={selectedRowKeys:s,onChange:t=>{p(t)},getCheckboxProps:t=>({disabled:!1,name:t.name})},u=s.length>0;return e.jsxs("div",{children:[e.jsxs(A,{children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(ne,{level:3,children:"物品管理"})}),j&&e.jsx("div",{style:{marginBottom:16},children:e.jsx(a.error,{content:j})}),e.jsx("div",{style:{marginBottom:16},children:e.jsxs(x,{children:[e.jsx(i,{type:"primary",icon:e.jsx(O,{}),onClick:F,children:"添加物品"}),e.jsx(I,{title:`确定要删除选中的 ${s.length} 个物品吗？`,onConfirm:v,okText:"确定",cancelText:"取消",disabled:!u,children:e.jsxs(i,{type:"primary",danger:!0,icon:e.jsx(f,{}),disabled:!u,children:["批量删除 (",s.length,")"]})}),e.jsx("span",{style:{marginLeft:8},children:u?`已选择 ${s.length} 项`:""})]})}),e.jsx(Q,{columns:P,dataSource:k,rowSelection:q,loading:R,rowKey:"id",pagination:{showSizeChanger:!0,showQuickJumper:!0,showTotal:(t,n)=>`第 ${n[0]}-${n[1]} 条，共 ${t} 条`},bordered:!0})]}),e.jsx(W,{title:o?"编辑物品":"添加物品",open:S,onOk:()=>{d.validateFields().then(t=>{K(t)}).catch(t=>{console.log("Validate Failed:",t)})},onCancel:()=>l(!1),confirmLoading:M,okText:o?"更新":"添加",cancelText:"取消",width:600,children:e.jsxs(m,{form:d,layout:"vertical",name:"itemForm",children:[e.jsx(m.Item,{label:"名称",name:"name",rules:[{required:!0,message:"请输入物品名称"}],children:e.jsx(G,{prefix:e.jsx(y,{}),placeholder:"请输入物品名称"})}),e.jsx(m.Item,{label:"价格",name:"price",rules:[{required:!0,message:"请输入价格"}],children:e.jsx(H,{prefix:e.jsx(U,{}),placeholder:"请输入价格",min:0,step:.01,style:{width:"100%"},formatter:t=>`¥ ${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t.replace(/\¥\s?|(,*)/g,"")})})]})})]})};export{re as default};
