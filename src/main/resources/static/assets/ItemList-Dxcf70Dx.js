import{a as P,r as h,F as m,b as r,j as e,C as Q,T as A,s as n,c as x,B as i,aY as J,aZ as I,a_ as f,aR as O,M as W,I as Y,aT as y,a$ as Z,aQ as _,h as G,R as H}from"./index-afCWbyQR.js";import{g as U,a as X,u as ee,b as te,d as se}from"./itemService-CvxgOJSs.js";const{Title:ae,Text:b}=A,re=()=>{const w=P(),[s,p]=h.useState([]),[R,l]=h.useState(!1),[o,g]=h.useState(null),[d]=m.useForm(),{data:S=[],loading:T,error:j,run:c}=r(U,{onError:t=>{console.error("Items fetch error:",t)}}),{run:$}=r(se,{manual:!0,onSuccess:()=>{n.success("删除成功"),c()}}),{run:k}=r(te,{manual:!0,onSuccess:()=>{n.success(`批量删除成功，共删除 ${s.length} 个物品`),p([]),c()}}),C=t=>{$(t)},v=()=>{if(s.length===0){n.warning("请选择要删除的物品");return}k(s)},F=()=>{g(null),d.resetFields(),l(!0)},B=t=>{w(`/items/${t.id}`)},D=t=>{g(t),d.setFieldsValue({name:t.name,price:t.price}),l(!0)},{run:L,loading:z}=r(X,{manual:!0,onSuccess:()=>{n.success("添加成功"),l(!1),c()}}),{run:E,loading:V}=r(ee,{manual:!0,onSuccess:()=>{n.success("更新成功"),l(!1),c()}}),M=z||V,K=t=>{o?E(o.id,t):L(t)},q=[{title:"ID",dataIndex:"id",key:"id",width:80},{title:"名称",dataIndex:"name",key:"name",render:t=>e.jsxs(x,{children:[e.jsx(y,{}),e.jsx(b,{strong:!0,children:t})]})},{title:"价格",dataIndex:"price",key:"price",width:120,render:t=>e.jsxs(b,{style:{color:"#52c41a",fontWeight:"bold"},children:["¥",t==null?void 0:t.toFixed(2)]})},{title:"操作",key:"action",width:200,render:(t,a)=>e.jsxs(x,{size:"middle",children:[e.jsx(i,{type:"default",size:"small",icon:e.jsx(G,{}),onClick:()=>B(a),children:"查看"}),e.jsx(i,{type:"primary",size:"small",icon:e.jsx(H,{}),onClick:()=>D(a),children:"编辑"}),e.jsx(I,{title:"确定要删除这个物品吗？",onConfirm:()=>C(a.id),okText:"确定",cancelText:"取消",children:e.jsx(i,{type:"primary",danger:!0,size:"small",icon:e.jsx(f,{}),children:"删除"})})]})}],N={selectedRowKeys:s,onChange:t=>{p(t)},getCheckboxProps:t=>({disabled:!1,name:t.name})},u=s.length>0;return e.jsxs("div",{children:[e.jsxs(Q,{children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(ae,{level:3,children:"物品管理"})}),j&&e.jsx("div",{style:{marginBottom:16},children:e.jsx(n.error,{content:j})}),e.jsx("div",{style:{marginBottom:16},children:e.jsxs(x,{children:[e.jsx(i,{type:"primary",icon:e.jsx(J,{}),onClick:F,children:"添加物品"}),e.jsx(I,{title:`确定要删除选中的 ${s.length} 个物品吗？`,onConfirm:v,okText:"确定",cancelText:"取消",disabled:!u,children:e.jsxs(i,{type:"primary",danger:!0,icon:e.jsx(f,{}),disabled:!u,children:["批量删除 (",s.length,")"]})}),e.jsx("span",{style:{marginLeft:8},children:u?`已选择 ${s.length} 项`:""})]})}),e.jsx(O,{columns:q,dataSource:S,rowSelection:N,loading:T,rowKey:"id",pagination:{showSizeChanger:!0,showQuickJumper:!0,showTotal:(t,a)=>`第 ${a[0]}-${a[1]} 条，共 ${t} 条`},bordered:!0})]}),e.jsx(W,{title:o?"编辑物品":"添加物品",open:R,onOk:()=>{d.validateFields().then(t=>{K(t)}).catch(t=>{console.log("Validate Failed:",t)})},onCancel:()=>l(!1),confirmLoading:M,okText:o?"更新":"添加",cancelText:"取消",width:600,children:e.jsxs(m,{form:d,layout:"vertical",name:"itemForm",children:[e.jsx(m.Item,{label:"名称",name:"name",rules:[{required:!0,message:"请输入物品名称"}],children:e.jsx(Y,{prefix:e.jsx(y,{}),placeholder:"请输入物品名称"})}),e.jsx(m.Item,{label:"价格",name:"price",rules:[{required:!0,message:"请输入价格"}],children:e.jsx(Z,{prefix:e.jsx(_,{}),placeholder:"请输入价格",min:0,step:.01,style:{width:"100%"},formatter:t=>`¥ ${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t.replace(/\¥\s?|(,*)/g,"")})})]})})]})};export{re as default};
